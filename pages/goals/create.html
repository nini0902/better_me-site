<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>æ–°å¢ç›®æ¨™ - æ›´å¥½çš„è‡ªå·±</title>
  <link rel="stylesheet" href="../../src/styles/main.css"/>
  <style>
    .simple-form {
      max-width: 600px;
      margin: 2rem auto;
      background-color: var(--nav-bg);
      padding: 2rem;
      border-radius: 16px;
      border: 1px solid var(--border-color);
    }

    .form-field {
      margin-bottom: 1.5rem;
    }

    .form-field label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: var(--accent-color);
      font-size: 0.95rem;
    }

    .form-field input,
    .form-field textarea,
    .form-field select {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      background-color: var(--bg-color);
      color: var(--text-color);
      font-size: 1rem;
      font-family: inherit;
      transition: all 0.3s ease;
    }

    .form-field input:focus,
    .form-field textarea:focus,
    .form-field select:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.1);
    }

    .form-field textarea {
      resize: vertical;
      min-height: 80px;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    .form-hint {
      font-size: 0.85rem;
      color: #94a3b8;
      margin-top: 0.3rem;
      font-style: italic;
    }

    .button-group {
      display: flex;
      gap: 1rem;
      margin-top: 2rem;
    }

    .btn {
      flex: 1;
      padding: 0.85rem 1.5rem;
      font-size: 1rem;
      font-weight: 600;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent-color), #7577f5);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
    }

    .btn-secondary {
      background-color: transparent;
      border: 1px solid var(--border-color);
      color: var(--text-color);
    }

    .btn-secondary:hover {
      border-color: var(--accent-color);
      color: var(--accent-color);
    }

    .success-message {
      display: none;
      background-color: #10b981;
      color: white;
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      text-align: center;
    }

    .error-message {
      display: none;
      background-color: #ef4444;
      color: white;
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="page-header">
      <h1>âœ¨ è¨­å®šæ–°ç›®æ¨™</h1>
      <p class="subtitle">é–‹å§‹ä½ çš„è›»è®Šä¹‹æ—…</p>
    </div>

    <nav>
      <a href="../../index.html">é¦–é </a>
      <a href="list.html">ç›®æ¨™åˆ—è¡¨</a>
      <a href="create.html" class="active">æ–°å¢ç›®æ¨™</a>
      <a href="../progress/track.html">é€²åº¦è¿½è¹¤</a>
    </nav>

    <main>
      <form id="goalForm" class="simple-form">
        <div id="successMsg" class="success-message"></div>
        <div id="errorMsg" class="error-message"></div>

        <!-- ç›®æ¨™åç¨± -->
        <div class="form-field">
          <label for="goalTitle">ğŸ“Œ ç›®æ¨™åç¨± *</label>
          <input 
            type="text" 
            id="goalTitle" 
            name="goalTitle" 
            placeholder="ä¾‹å¦‚ï¼šæ¯å¤©å–æ°´ 2000ml"
            required
          >
          <div class="form-hint">ç°¡æ½”æ˜ç¢ºçš„ç›®æ¨™åç¨±</div>
        </div>

        <!-- é¡åˆ¥ -->
        <div class="form-field">
          <label for="goalCategory">ğŸ·ï¸ é¡åˆ¥ *</label>
          <select id="goalCategory" name="goalCategory" required>
            <option value="">-- é¸æ“‡é¡åˆ¥ --</option>
            <option value="health">ğŸ’ª å¥åº·é‹å‹•</option>
            <option value="learning">ğŸ“š å­¸ç¿’æˆé•·</option>
            <option value="career">ğŸ¯ å·¥ä½œè·æ¶¯</option>
            <option value="relationship">ğŸ’ äººéš›é—œä¿‚</option>
            <option value="finance">ğŸ’° ç†è²¡æŠ•è³‡</option>
            <option value="hobby">ğŸ¨ èˆˆè¶£æ„›å¥½</option>
            <option value="other">âœ¨ å…¶ä»–</option>
          </select>
        </div>

        <!-- æè¿° -->
        <div class="form-field">
          <label for="goalDescription">ğŸ“ ç‚ºä»€éº¼è¦åšé€™å€‹ç›®æ¨™ï¼Ÿ *</label>
          <textarea 
            id="goalDescription" 
            name="goalDescription"
            placeholder="å¯«ä¸‹ä½ æƒ³é”æˆé€™å€‹ç›®æ¨™çš„åŸå› å’Œæ–¹æ³•..."
            required
          ></textarea>
          <div class="form-hint">å¹«åŠ©ä½ ä¿æŒå‹•åŠ›çš„é—œéµ</div>
        </div>

        <!-- ç›®æ¨™æ™‚é–“å’Œæ•¸å€¼ -->
        <div class="form-row">
          <div class="form-field">
            <label for="targetDate">ğŸ—“ï¸ ç›®æ¨™å®Œæˆæ—¥æœŸ *</label>
            <input type="date" id="targetDate" name="targetDate" required>
            <div class="form-hint" id="daysHint"></div>
          </div>

          <div class="form-field">
            <label for="quantValue">ğŸ“Š ç›®æ¨™æ•¸å€¼ï¼ˆå¯é¸ï¼‰</label>
            <input 
              type="number" 
              id="quantValue" 
              name="quantValue" 
              placeholder="ä¾‹å¦‚ï¼š2000"
              min="0"
            >
          </div>
        </div>

        <!-- å–®ä½ -->
        <div class="form-field">
          <label for="quantUnit">ğŸ“ å–®ä½ï¼ˆå¯é¸ï¼‰</label>
          <input 
            type="text" 
            id="quantUnit" 
            name="quantUnit" 
            placeholder="ä¾‹å¦‚ï¼šmlã€åˆ†é˜ã€æ¬¡ã€é "
          >
          <div class="form-hint">æ­é…æ•¸å€¼ä½¿ç”¨ï¼Œä¾‹å¦‚ã€Œ2000 mlã€ã€ã€Œ20 åˆ†é˜ã€</div>
        </div>

        <!-- æŒ‰éˆ• -->
        <div class="button-group">
          <button type="submit" class="btn btn-primary">âœ… å»ºç«‹ç›®æ¨™</button>
          <button type="reset" class="btn btn-secondary">ğŸ”„ é‡è¨­</button>
        </div>
      </form>
    </main>
  </div>

  <script src="../../src/js/core.js"></script>
  <script>
    (function() {
      const form = document.getElementById('goalForm');
      const titleInput = document.getElementById('goalTitle');
      const categorySelect = document.getElementById('goalCategory');
      const descriptionTextarea = document.getElementById('goalDescription');
      const targetDateInput = document.getElementById('targetDate');
      const quantValueInput = document.getElementById('quantValue');
      const quantUnitInput = document.getElementById('quantUnit');
      const successMsg = document.getElementById('successMsg');
      const errorMsg = document.getElementById('errorMsg');
      const daysHint = document.getElementById('daysHint');

      // è¨ˆç®—å‰©é¤˜å¤©æ•¸
      targetDateInput.addEventListener('change', () => {
        const target = new Date(targetDateInput.value);
        const today = new Date();
        const days = Math.ceil((target - today) / (1000 * 60 * 60 * 24));

        if (days < 0) {
          daysHint.textContent = 'âš ï¸ æ—¥æœŸä¸èƒ½æ˜¯éå»';
          daysHint.style.color = '#ef4444';
        } else if (days === 0) {
          daysHint.textContent = 'â° ä»Šå¤©æˆªæ­¢';
          daysHint.style.color = '#f59e0b';
        } else {
          daysHint.textContent = `â³ å‰©é¤˜ ${days} å¤©`;
          daysHint.style.color = '#10b981';
        }
      });

      // æäº¤è¡¨å–®
      form.addEventListener('submit', (e) => {
        e.preventDefault();

        // åŸºæœ¬é©—è­‰
        if (!titleInput.value.trim()) {
          showError('è«‹è¼¸å…¥ç›®æ¨™åç¨±');
          return;
        }

        if (!categorySelect.value) {
          showError('è«‹é¸æ“‡ç›®æ¨™é¡åˆ¥');
          return;
        }

        if (!descriptionTextarea.value.trim()) {
          showError('è«‹æè¿°ä½ çš„ç›®æ¨™');
          return;
        }

        if (!targetDateInput.value) {
          showError('è«‹é¸æ“‡ç›®æ¨™å®Œæˆæ—¥æœŸ');
          return;
        }

        const targetDate = new Date(targetDateInput.value);
        if (targetDate < new Date()) {
          showError('ç›®æ¨™æ—¥æœŸä¸èƒ½æ˜¯éå»');
          return;
        }

        try {
          // æ–°å¢ç›®æ¨™
          const goalData = {
            title: titleInput.value.trim(),
            category: categorySelect.value,
            description: descriptionTextarea.value.trim(),
            targetDate: targetDateInput.value,
            quantValue: quantValueInput.value ? parseInt(quantValueInput.value) : 0,
            quantUnit: quantUnitInput.value.trim()
          };

          const newGoal = window.goalManager.addGoal(goalData);
          
          // ç”Ÿæˆæ’ç¨‹
          const schedule = window.goalManager.generateHabitSchedule(newGoal);
          window.goalManager.updateGoal(newGoal.id, { schedule });

          // æˆåŠŸæç¤º
          showSuccess('âœ… ç›®æ¨™å»ºç«‹æˆåŠŸï¼');

          // 1.5ç§’å¾Œè·³è½‰åˆ°é€²åº¦è¿½è¹¤é é¢
          setTimeout(() => {
            window.location.href = `../progress/track.html?id=${newGoal.id}`;
          }, 1500);

        } catch (err) {
          console.error(err);
          showError('ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹é‡è©¦');
        }
      });

      function showSuccess(msg) {
        successMsg.textContent = msg;
        successMsg.style.display = 'block';
        errorMsg.style.display = 'none';
      }

      function showError(msg) {
        errorMsg.textContent = msg;
        errorMsg.style.display = 'block';
        successMsg.style.display = 'none';
      }

      // åˆå§‹åŒ–æ—¥æœŸ
      targetDateInput.valueAsDate = new Date();
      targetDateInput.dispatchEvent(new Event('change'));
    })();
  </script>
</body>
</html>
